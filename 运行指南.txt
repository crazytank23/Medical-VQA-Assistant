================================================================
           Qwen2-VL 医疗多模态诊断助手 - 运行指南
================================================================

感谢您评阅本作业。为了确保 Demo 能够顺利运行，请按照以下步骤进行配置。

一、 环境准备 (Environment Setup)
----------------------------------------------------------------
本项目基于 LLaMA-Factory 框架运行，依赖 Python 3.10+ 环境。

1. 创建并激活 Conda 虚拟环境：
   conda create -n qwen_env python=3.10
   conda activate qwen_env

2. 安装项目依赖：
   在当前目录下打开命令行，运行：
   pip install -r requirements.txt

   (核心依赖包括: llamafactory, modelscope, qwen-vl-utils, torch)


二、 模型准备 (Model Preparation)
----------------------------------------------------------------
由于作业提交的文件大小限制，本压缩包仅包含微调后的 LoRA 权重 (Adapter)，
不包含 Qwen2-VL-2B 基座模型 (Base Model)。

1. 请自行从 ModelScope 或 HuggingFace 下载 "Qwen2-VL-2B-Instruct" 模型。
   下载链接参考: https://modelscope.cn/models/qwen/Qwen2-VL-2B-Instruct

2. 请记住您下载的基座模型文件夹的绝对路径 (例如 D:\Models\Qwen2-VL-2B)，
   稍后需要在启动脚本中填入该路径。


三、 配置启动脚本 (Configuration) - [关键步骤]
----------------------------------------------------------------
为了适配您的本地路径，运行前请务必编辑启动脚本。

1. 找到项目根目录下的 "run_cmd_demo.bat" 文件。
2. 右键点击该文件，选择 "编辑" (或用记事本打开)。
3. 在文件开头的 "CONFIGURATION" 区域，修改以下 3 个变量：

   (1) PROJECT_ROOT
       修改为您存放本项目代码的根目录路径。
       示例: set PROJECT_ROOT=D:\Homework\Medical-VQA-Assistant

   (2) MODEL_PATH
       修改为您在第二步中下载的基座模型路径。
       示例: set MODEL_PATH=D:\Models\Qwen2-VL-2B

   (3) CONDA_ACTIVATE
       修改为您电脑上 Anaconda 的 activate.bat 路径。
       示例: set CONDA_ACTIVATE=C:\ProgramData\Anaconda3\Scripts\activate.bat

4. 修改完成后，保存并关闭文件。


四、 启动与交互 (Launch & Interaction)
----------------------------------------------------------------
1. 双击修改后的 "run_cmd_demo.bat" 文件。
2. 等待脚本自动激活环境并加载模型 (首次加载可能需要 1-2 分钟)。
3. 当黑框中出现绿色的 "User:" 提示符时，即可开始对话。

[交互方式]
支持直接将图片文件拖入命令行窗口。

示例操作流程：
Step 1: 用鼠标将 "assets" 文件夹下的 "test_xray.png" 拖入黑框。
Step 2: 在路径后补全指令标签，例如输入：
        <image>自动填入的路径</image> 请生成这份影像的诊断报告。
Step 3: 按回车键等待模型回复。


五、 常见问题 (Troubleshooting)
----------------------------------------------------------------
* 如果双击 bat 文件一闪而过：
  请右键选择 "编辑"，在文件最后一行加上 "pause"，再次运行查看报错信息。
  通常是因为 PROJECT_ROOT 或 MODEL_PATH 路径填写错误。

* 如果提示 "conda不是内部或外部命令"：
  请检查 CONDA_ACTIVATE 变量是否指向了正确的 activate.bat 文件位置。

================================================================